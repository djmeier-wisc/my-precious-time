'use client';

import {MapContainer, Marker, Polyline, TileLayer} from 'react-leaflet';
import {useEffect, useReducer, useRef, useState} from 'react';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import {getRandomShape} from "../../api/transitDelayServiceApi";

const trainIcon = L.icon({
    iconUrl: '/train.png',
    iconSize: [32, 32],
    iconAnchor: [16, 16],
});
const initialState = {
    progress: 0,
    currIndex: 0,
    direction: 1
};
const defaultRoute = [
    [43.057379, -89.527677], [43.058497, -89.527455], [43.06056, -89.508966], [43.093342, -89.35765], [43.093471, -89.357478], [43.0936, -89.357306], [43.093728, -89.357133], [43.093857, -89.356961], [43.093986, -89.35679], [43.094115, -89.356619], [43.094244, -89.356447], [43.094374, -89.356276], [43.094503, -89.356104], [43.060563, -89.50872], [43.094632, -89.355933], [43.094761, -89.355762], [43.09489, -89.35559], [43.09502, -89.355419], [43.095149, -89.355248], [43.095278, -89.355077], [43.095408, -89.354906], [43.095537, -89.354734], [43.095666, -89.354563], [43.095796, -89.354392], [43.060565, -89.508474], [43.095925, -89.354221], [43.096054, -89.354049], [43.096201, -89.353908], [43.096285, -89.353827], [43.09641, -89.353649], [43.096534, -89.353472], [43.096659, -89.353294], [43.096784, -89.353117], [43.096908, -89.352939], [43.097033, -89.352761], [43.060568, -89.508227], [43.097157, -89.352584], [43.097238, -89.352469], [43.097367, -89.352297], [43.097495, -89.352124], [43.097624, -89.351952], [43.097703, -89.351846], [43.097832, -89.351675], [43.097962, -89.351504], [43.098091, -89.351333], [43.098221, -89.351162], [43.060571, -89.507981], [43.098338, -89.351007], [43.098436, -89.350878], [43.098564, -89.350705], [43.098692, -89.350532], [43.09882, -89.350359], [43.098948, -89.350186], [43.099076, -89.350013], [43.099204, -89.34984], [43.099332, -89.349667], [43.09946, -89.349494], [43.060573, -89.507802], [43.099496, -89.349446], [43.09956, -89.349352], [43.099629, -89.349261], [43.099702, -89.349174], [43.099779, -89.34909], [43.09986, -89.34901], [43.099945, -89.348935], [43.100034, -89.348864], [43.100191, -89.348745], [43.100357, -89.34865], [43.060611, -89.507561], [43.100523, -89.348554], [43.100597, -89.348512], [43.100746, -89.348374], [43.100895, -89.348235], [43.100944, -89.348189], [43.101099, -89.348065], [43.10121, -89.347976], [43.101328, -89.347867], [43.10144, -89.347753], [43.101548, -89.347634], [43.060634, -89.507415], [43.10165, -89.347511], [43.101746, -89.347383], [43.101837, -89.347251], [43.101921, -89.347115], [43.102, -89.346975], [43.102073, -89.346832], [43.102166, -89.346621], [43.102258, -89.34641], [43.102345, -89.346194], [43.102432, -89.345978], [43.060631, -89.507169], [43.10252, -89.345763], [43.102607, -89.345548], [43.102694, -89.345332], [43.102781, -89.345117], [43.102806, -89.345055], [43.102891, -89.344838], [43.102977, -89.344621], [43.103062, -89.344405], [43.103148, -89.344188], [43.103233, -89.343971], [43.060629, -89.506923], [43.103319, -89.343754], [43.103404, -89.343537], [43.103489, -89.343321], [43.103537, -89.3432], [43.103627, -89.342987], [43.103663, -89.342902], [43.103727, -89.342746], [43.103795, -89.342593], [43.10387, -89.342442], [43.103949, -89.342293], [43.058677, -89.527453], [43.060627, -89.506677], [43.104085, -89.342132], [43.104166, -89.342036], [43.104277, -89.341842], [43.104354, -89.341706], [43.104491, -89.341546], [43.104628, -89.341387], [43.104765, -89.341228], [43.104903, -89.341068], [43.10504, -89.340909], [43.105182, -89.340757], [43.060625, -89.50643], [43.105326, -89.34061], [43.105362, -89.340573], [43.105509, -89.340432], [43.105659, -89.340295], [43.105698, -89.340259], [43.10585, -89.340127], [43.106001, -89.339994], [43.106153, -89.339862], [43.106189, -89.33983], [43.106286, -89.339742], [43.060622, -89.506184], [43.10638, -89.339651], [43.10647, -89.339556], [43.106557, -89.339458], [43.106697, -89.339303], [43.106835, -89.339145], [43.10697, -89.338982], [43.107101, -89.338813], [43.107228, -89.338639], [43.107314, -89.338521], [43.107427, -89.338373], [43.06062, -89.505938], [43.107535, -89.338222], [43.107638, -89.338067], [43.107736, -89.337908], [43.107828, -89.337747], [43.107915, -89.337582], [43.108023, -89.337385], [43.108135, -89.337192], [43.108174, -89.337124], [43.10829, -89.336936], [43.108409, -89.336751], [43.060618, -89.505692], [43.108455, -89.336679], [43.108578, -89.3365], [43.108705, -89.336324], [43.108759, -89.336249], [43.108902, -89.3361], [43.109045, -89.33595], [43.109077, -89.335917], [43.109185, -89.33572], [43.109262, -89.335578], [43.109394, -89.335411], [43.060615, -89.505446], [43.109527, -89.335244], [43.109659, -89.335077], [43.109791, -89.33491], [43.109923, -89.334743], [43.110055, -89.334576], [43.110139, -89.33447], [43.110266, -89.334295], [43.110392, -89.33412], [43.110477, -89.334004], [43.110604, -89.33383], [43.060614, -89.505294], [43.110731, -89.333655], [43.110858, -89.333481], [43.11097, -89.333327], [43.111098, -89.333154], [43.111227, -89.332982], [43.111355, -89.332809], [43.111483, -89.332636], [43.111611, -89.332463], [43.11174, -89.332291], [43.111868, -89.332118], [43.060616, -89.505048], [43.111996, -89.331945], [43.112124, -89.331772], [43.112253, -89.3316], [43.112381, -89.331427], [43.112509, -89.331254], [43.112637, -89.331082], [43.112766, -89.330909], [43.112894, -89.330736], [43.113013, -89.330576], [43.113182, -89.330492], [43.060618, -89.504802], [43.113269, -89.330449], [43.113446, -89.330495], [43.113623, -89.33054], [43.113799, -89.330586], [43.113976, -89.330632], [43.114083, -89.330663], [43.11416, -89.33068], [43.114238, -89.330691], [43.114317, -89.330696], [43.114397, -89.330694], [43.060621, -89.504556], [43.114577, -89.330683], [43.114756, -89.330673], [43.114936, -89.330662], [43.115116, -89.330651], [43.115295, -89.330641], [43.115428, -89.330633], [43.115608, -89.330625], [43.115788, -89.330617], [43.115967, -89.33061], [43.116147, -89.330602], [43.058857, -89.52745], [43.060623, -89.504309], [43.116327, -89.330594], [43.116507, -89.330586], [43.116686, -89.330578], [43.116866, -89.330571], [43.117046, -89.330563], [43.117226, -89.330555], [43.117406, -89.330548], [43.117585, -89.330541], [43.117721, -89.330535], [43.117901, -89.330526], [43.060625, -89.504063], [43.11808, -89.330517], [43.11826, -89.330507], [43.11844, -89.330498], [43.118501, -89.330495], [43.118681, -89.330492], [43.118861, -89.330489], [43.119041, -89.330487], [43.11921, -89.330484], [43.11939, -89.330474], [43.119569, -89.330464], [43.060627, -89.503817], [43.119749, -89.330454], [43.119929, -89.330445], [43.120109, -89.330436], [43.120157, -89.330434], [43.120081, -89.330211], [43.120033, -89.330072], [43.120043, -89.329826], [43.120052, -89.32958], [43.120061, -89.329334], [43.12007, -89.329088], [43.06063, -89.503571], [43.12008, -89.328842], [43.120089, -89.328596], [43.120099, -89.328349], [43.120104, -89.328206], [43.120107, -89.328102], [43.120116, -89.327999], [43.120132, -89.327897], [43.120154, -89.327796], [43.120182, -89.327696], [43.120215, -89.327599], [43.060632, -89.503325], [43.120255, -89.327503], [43.1203, -89.32741], [43.120423, -89.32723], [43.120546, -89.327051], [43.120669, -89.326871], [43.120707, -89.326816], [43.120767, -89.326729], [43.120821, -89.326641], [43.12087, -89.32655], [43.120913, -89.326457], [43.060634, -89.503079], [43.12095, -89.326361], [43.120982, -89.326262], [43.121007, -89.326162], [43.121026, -89.326061], [43.12104, -89.325959], [43.121047, -89.325856], [43.121047, -89.325753], [43.121051, -89.325507], [43.121055, -89.32526], [43.121058, -89.32504], [43.060636, -89.502858], [43.121061, -89.324849], [43.121074, -89.324603], [43.12107, -89.324521], [43.121073, -89.324453], [43.121099, -89.324391], [43.121015, -89.324173], [43.12093, -89.323956], [43.120877, -89.323819], [43.120834, -89.323828], [43.120791, -89.323822], [43.060636, -89.502651], [43.120752, -89.323803], [43.120619, -89.323637], [43.120486, -89.323471], [43.120354, -89.323304], [43.120221, -89.323138], [43.120088, -89.322972], [43.119955, -89.322806], [43.119903, -89.322741], [43.119771, -89.322573], [43.119639, -89.322406], [43.060639, -89.502405], [43.119606, -89.322363], [43.119474, -89.322196], [43.119342, -89.322029], [43.11921, -89.321861], [43.119078, -89.321694], [43.118946, -89.321527], [43.118923, -89.321282], [43.118906, -89.321093], [43.119032, -89.320917], [43.119158, -89.320742], [43.060642, -89.502159], [43.119285, -89.320566], [43.119411, -89.320391], [43.119537, -89.320215], [43.119663, -89.320039], [43.119789, -89.319864], [43.119915, -89.319688], [43.120042, -89.319513], [43.120168, -89.319337], [43.120294, -89.319161], [43.12042, -89.318986], [43.059037, -89.527447], [43.060645, -89.501913], [43.120546, -89.31881], [43.120672, -89.318634], [43.120799, -89.318459], [43.120925, -89.318283], [43.121051, -89.318107], [43.121177, -89.317932], [43.121271, -89.317801], [43.121394, -89.317622], [43.121518, -89.317442], [43.121641, -89.317263], [43.060648, -89.501666], [43.121764, -89.317084], [43.121888, -89.316904], [43.122011, -89.316725], [43.122134, -89.316545], [43.122258, -89.316366], [43.122381, -89.316187], [43.122504, -89.316007], [43.122628, -89.315828], [43.122683, -89.315748], [43.122806, -89.315569], [43.060651, -89.50142], [43.12293, -89.315389], [43.123053, -89.31521], [43.123176, -89.31503], [43.123299, -89.314851], [43.123423, -89.314671], [43.123546, -89.314492], [43.123625, -89.31427], [43.1237, -89.314057], [43.123827, -89.313882], [43.123953, -89.313707], [43.060653, -89.501244], [43.12408, -89.313532], [43.124207, -89.313357], [43.124333, -89.313182], [43.12446, -89.313007], [43.124587, -89.312832], [43.124713, -89.312657], [43.12484, -89.312482], [43.124966, -89.312307], [43.125093, -89.312132], [43.12522, -89.311957], [43.060654, -89.500998], [43.125346, -89.311782], [43.125473, -89.311607], [43.1256, -89.311432], [43.125726, -89.311257], [43.125853, -89.311082], [43.12598, -89.310907], [43.126106, -89.310732], [43.126233, -89.310557], [43.12636, -89.310382], [43.126398, -89.310329], [43.060656, -89.500752], [43.126522, -89.310151], [43.126646, -89.309972], [43.12677, -89.309794], [43.126895, -89.309616], [43.127019, -89.309437], [43.127143, -89.309259], [43.127267, -89.309081], [43.127391, -89.308902], [43.127515, -89.308724], [43.12764, -89.308546], [43.060657, -89.500505], [43.127764, -89.308368], [43.127888, -89.308189], [43.127955, -89.307961], [43.127992, -89.307836], [43.128122, -89.307665], [43.128251, -89.307494], [43.128381, -89.307324], [43.128511, -89.307153], [43.128641, -89.306983], [43.12877, -89.306812], [43.060659, -89.500259], [43.1289, -89.306641], [43.12903, -89.306471], [43.12916, -89.3063], [43.129289, -89.306129], [43.129419, -89.305959], [43.129549, -89.305788], [43.129653, -89.305651], [43.129779, -89.305476], [43.129906, -89.3053], [43.130032, -89.305125], [43.060661, -89.500013], [43.130158, -89.304949], [43.13022, -89.304863], [43.130343, -89.304683], [43.130466, -89.304503], [43.130589, -89.304323], [43.130712, -89.304144], [43.130835, -89.303964], [43.130941, -89.303765], [43.131048, -89.303567], [43.131155, -89.303368], [43.060663, -89.499767], [43.131261, -89.30317], [43.131368, -89.302971], [43.131399, -89.302913], [43.13156, -89.302804], [43.131722, -89.302696], [43.131851, -89.302524], [43.13198, -89.302353], [43.132113, -89.302187], [43.132245, -89.302019], [43.132378, -89.301853], [43.059217, -89.527444], [43.060665, -89.499521], [43.132511, -89.301687], [43.132644, -89.301522], [43.132777, -89.301355], [43.132909, -89.301188], [43.132994, -89.301083], [43.133127, -89.300917], [43.13326, -89.300751], [43.133393, -89.300586], [43.133526, -89.30042], [43.133659, -89.300254], [43.060667, -89.499275], [43.133792, -89.300088], [43.133925, -89.299922], [43.134059, -89.299756], [43.134192, -89.299591], [43.134229, -89.299544], [43.134363, -89.299379], [43.134496, -89.299214], [43.13463, -89.299049], [43.134764, -89.298884], [43.134897, -89.298719], [43.060669, -89.499029], [43.135031, -89.298554], [43.135164, -89.298389], [43.13527, -89.298259], [43.135404, -89.298095], [43.135538, -89.297931], [43.135673, -89.297767], [43.135807, -89.297603], [43.135941, -89.297439], [43.136075, -89.297275], [43.13621, -89.297111], [43.060671, -89.498782], [43.136251, -89.29706], [43.136384, -89.296895], [43.136517, -89.296729], [43.13665, -89.296563], [43.136783, -89.296397], [43.136903, -89.296247], [43.137024, -89.296096], [43.137157, -89.29593], [43.137291, -89.295765], [43.137424, -89.2956], [43.060673, -89.498536], [43.13751, -89.295494], [43.137644, -89.295329], [43.137778, -89.295165], [43.137911, -89.295], [43.138045, -89.294835], [43.138179, -89.29467], [43.138313, -89.294505], [43.138446, -89.29434], [43.13858, -89.294176], [43.138714, -89.294011], [43.060675, -89.49829], [43.138848, -89.293846], [43.138981, -89.293681], [43.139115, -89.293516], [43.139249, -89.293352], [43.139383, -89.293187], [43.139516, -89.293022], [43.13965, -89.292857], [43.139784, -89.292692], [43.139918, -89.292528], [43.140051, -89.292363], [43.060677, -89.498044], [43.140185, -89.292198], [43.140319, -89.292033], [43.14045, -89.291865], [43.140581, -89.291696], [43.140712, -89.291527], [43.140844, -89.291359], [43.140975, -89.29119], [43.141051, -89.291092], [43.141185, -89.290927], [43.141318, -89.290762], [43.060679, -89.497798], [43.141452, -89.290597], [43.141555, -89.29047], [43.141689, -89.290306], [43.141824, -89.290142], [43.141958, -89.289978], [43.142043, -89.289875], [43.142177, -89.289711], [43.142311, -89.289547], [43.142446, -89.289383], [43.14258, -89.289219], [43.060681, -89.497552], [43.142714, -89.289055], [43.142847, -89.288888], [43.142979, -89.288722], [43.143112, -89.288555], [43.143245, -89.288388], [43.143377, -89.288222], [43.143511, -89.288057], [43.143644, -89.287891], [43.143778, -89.287726], [43.143911, -89.287561], [43.060683, -89.497305], [43.144045, -89.287396], [43.144178, -89.28723], [43.144302, -89.287077], [43.144431, -89.286905], [43.144475, -89.286845], [43.14461, -89.286683], [43.144746, -89.286521], [43.144881, -89.286358], [43.145017, -89.286196], [43.145152, -89.286034], [43.059397, -89.527442], [43.060685, -89.497093], [43.145288, -89.285872], [43.145386, -89.285754], [43.145519, -89.285588], [43.145653, -89.285424], [43.145788, -89.28526], [43.145922, -89.285096], [43.146057, -89.284933], [43.146191, -89.284769], [43.146326, -89.284605], [43.146397, -89.284379], [43.060724, -89.496853], [43.146453, -89.284205], [43.146528, -89.283981], [43.146548, -89.28392], [43.146579, -89.283853], [43.146604, -89.283784], [43.146623, -89.283712], [43.146634, -89.28364], [43.146639, -89.283566], [43.146637, -89.283492], [43.146629, -89.283419], [43.060748, -89.496702], [43.146613, -89.283347], [43.146591, -89.283277], [43.146562, -89.283209], [43.146528, -89.283144], [43.146487, -89.283082], [43.146441, -89.283025], [43.146389, -89.282972], [43.146333, -89.282924], [43.146273, -89.282881], [43.146209, -89.282844], [43.060747, -89.496456], [43.146142, -89.282814], [43.146072, -89.282789], [43.146001, -89.282772], [43.145928, -89.282761], [43.145854, -89.282757], [43.14578, -89.282759], [43.145707, -89.282769], [43.145635, -89.282785], [43.145565, -89.282808], [43.145498, -89.282837], [43.060746, -89.49621], [43.145433, -89.282873], [43.145372, -89.282914], [43.145315, -89.282961], [43.145262, -89.283012], [43.145215, -89.283069], [43.145173, -89.28313], [43.145137, -89.283194], [43.145107, -89.283261], [43.145083, -89.283331], [43.145066, -89.283403], [43.060745, -89.495963], [43.145056, -89.283476], [43.145053, -89.28355], [43.145056, -89.283623], [43.145054, -89.283703], [43.145057, -89.283783], [43.145065, -89.283862], [43.145077, -89.283941], [43.145127, -89.284178], [43.145177, -89.284415], [43.145212, -89.284582], [43.060743, -89.495717], [43.145281, -89.28481], [43.145349, -89.285038], [43.145418, -89.285266], [43.145487, -89.285493], [43.145516, -89.285591], [43.145565, -89.285739], [43.145599, -89.285847], [43.145669, -89.286074], [43.14574, -89.286301], [43.14581, -89.286528], [43.060742, -89.495471], [43.145881, -89.286754], [43.145951, -89.286981], [43.146022, -89.287208], [43.146092, -89.287435], [43.146153, -89.287631], [43.146225, -89.287857], [43.146292, -89.288065], [43.146332, -89.288195], [43.146378, -89.288323], [43.14643, -89.288449], [43.060741, -89.495225], [43.146488, -89.288571], [43.146552, -89.288691], [43.146622, -89.288808], [43.146698, -89.288922], [43.146778, -89.289031], [43.146864, -89.289137], [43.146955, -89.289238], [43.147051, -89.289334], [43.147151, -89.289426], [43.147255, -89.289514], [43.06074, -89.494979], [43.147364, -89.289595], [43.147476, -89.289672], [43.147592, -89.289743], [43.147712, -89.289809], [43.147834, -89.289868], [43.147771, -89.290099], [43.147761, -89.290345], [43.147754, -89.290526], [43.147625, -89.290698], [43.147526, -89.290831], [43.059577, -89.527439], [43.060739, -89.494733], [43.147476, -89.290914], [43.14742, -89.290993], [43.147358, -89.291068], [43.147291, -89.291139], [43.147219, -89.291205], [43.147143, -89.291266], [43.147063, -89.291321], [43.14698, -89.29137], [43.146893, -89.291414], [43.14672, -89.291483], [43.060738, -89.494486], [43.146548, -89.291552], [43.146375, -89.29162], [43.146202, -89.291689], [43.146115, -89.291724], [43.14597, -89.291869], [43.145876, -89.291963], [43.145696, -89.291968], [43.145516, -89.291974], [43.145465, -89.291975], [43.145422, -89.291992], [43.060736, -89.49424], [43.145384, -89.292015], [43.145217, -89.292107], [43.145107, -89.292167], [43.144951, -89.292289], [43.144803, -89.29243], [43.144736, -89.292495], [43.144616, -89.29265], [43.144504, -89.292804], [43.144399, -89.293004], [43.144315, -89.293191], [43.060735, -89.493994], [43.144252, -89.293422], [43.144188, -89.293652], [43.144146, -89.293892], [43.144134, -89.29396], [43.144115, -89.294205], [43.144119, -89.294452], [43.144122, -89.29459], [43.144158, -89.294832], [43.144189, -89.295038], [43.144234, -89.295206], [43.060734, -89.493748], [43.144358, -89.295385], [43.144437, -89.2955], [43.144498, -89.295732], [43.14454, -89.295889], [43.14461, -89.295992], [43.144684, -89.296093], [43.144764, -89.296189], [43.144848, -89.296282], [43.144937, -89.29637], [43.145091, -89.296497], [43.060733, -89.493502], [43.145245, -89.296625], [43.145399, -89.296752], [43.145434, -89.296781], [43.145539, -89.296867], [43.145639, -89.296958], [43.145735, -89.297054], [43.145827, -89.297154], [43.145913, -89.297258], [43.145994, -89.297367], [43.146069, -89.297479], [43.060732, -89.493256], [43.146139, -89.297595], [43.146249, -89.29779], [43.146359, -89.297985], [43.146388, -89.298035], [43.146437, -89.298143], [43.146491, -89.298248], [43.146552, -89.298349], [43.146618, -89.298448], [43.146689, -89.298542], [43.146766, -89.298632], [43.060731, -89.493009], [43.146848, -89.298718], [43.146934, -89.298799], [43.147024, -89.298875], [43.147119, -89.298946], [43.147217, -89.299012], [43.147319, -89.299072], [43.147424, -89.299126], [43.147532, -89.299174], [43.147712, -89.299163], [43.147879, -89.299152], [43.06073, -89.492763], [43.148047, -89.299241], [43.148215, -89.29933], [43.148339, -89.299336], [43.148458, -89.299333], [43.148575, -89.299324], [43.148753, -89.299289], [43.148931, -89.299254], [43.149109, -89.29922], [43.149287, -89.299185], [43.149465, -89.29915], [43.060728, -89.492517], [43.149643, -89.299115], [43.149821, -89.299081], [43.15, -89.299046], [43.150178, -89.299011], [43.150245, -89.298998], [43.150423, -89.298963], [43.150601, -89.298929], [43.150779, -89.298894], [43.150957, -89.298859], [43.151107, -89.29884], [43.059756, -89.527436], [43.060727, -89.492271], [43.151224, -89.298833], [43.151369, -89.298825], [43.151549, -89.29876], [43.151671, -89.298792], [43.151793, -89.298825], [43.151916, -89.298857], [43.152038, -89.298889], [43.152148, -89.298923], [43.152258, -89.298958], [43.15242, -89.299098], [43.060726, -89.492025], [43.152582, -89.299238], [43.152684, -89.299321], [43.152785, -89.299404], [43.152893, -89.299535], [43.153001, -89.299667], [43.153124, -89.299828], [43.153247, -89.299989], [43.153349, -89.300195], [43.153451, -89.300402], [43.153525, -89.3006], [43.060727, -89.491779], [43.153599, -89.300799], [43.153647, -89.300934], [43.153695, -89.30107], [43.153743, -89.301205], [43.153791, -89.301341], [43.153778, -89.301587], [43.153764, -89.301833], [43.153776, -89.301997], [43.153782, -89.302161], [43.153781, -89.302325], [43.060727, -89.491532], [43.153783, -89.302572], [43.153785, -89.302818], [43.153786, -89.302997], [43.153789, -89.303177], [43.153787, -89.303357], [43.15378, -89.303536], [43.153767, -89.303716], [43.15375, -89.303895], [43.153738, -89.304079], [43.153734, -89.304263], [43.060727, -89.491286], [43.153736, -89.304447], [43.153796, -89.304468], [43.153846, -89.304508], [43.15388, -89.304562], [43.153893, -89.304624], [43.153894, -89.304688], [43.153881, -89.304752], [43.153847, -89.304808], [43.153796, -89.304849], [43.153735, -89.30487], [43.060728, -89.49104], [43.15376, -89.305036], [43.153758, -89.305283], [43.153755, -89.305529], [43.153753, -89.305776], [43.153751, -89.305968], [43.153748, -89.306215], [43.153746, -89.306461], [43.153744, -89.306708], [43.153742, -89.306954], [43.153741, -89.307201], [43.060728, -89.490794], [43.153739, -89.307447], [43.153737, -89.307694], [43.153735, -89.30794], [43.153733, -89.308187], [43.153732, -89.308284], [43.153735, -89.308531], [43.153737, -89.308777], [43.15374, -89.309024], [43.153742, -89.30927], [43.153745, -89.309517], [43.060729, -89.490548], [43.153742, -89.309763], [43.153739, -89.31001], [43.153738, -89.310144], [43.153738, -89.310391], [43.153739, -89.310637], [43.153739, -89.310884], [43.15374, -89.31113], [43.153737, -89.311377], [43.153733, -89.311623], [43.15373, -89.31187], [43.060729, -89.490302], [43.153727, -89.312116], [43.153724, -89.312332], [43.153723, -89.312579], [43.153722, -89.312825], [43.153721, -89.313072], [43.15372, -89.313318], [43.153718, -89.313565], [43.153718, -89.313652], [43.153716, -89.313899], [43.153714, -89.314145], [43.06073, -89.490055], [43.153711, -89.314392], [43.15371, -89.314539], [43.153708, -89.314786], [43.153707, -89.315032], [43.153748, -89.315272], [43.153789, -89.315512], [43.153803, -89.315591], [43.147712, -89.299163], [43.147879, -89.299152], [43.148047, -89.299241], [43.059936, -89.527433], [43.06073, -89.489809], [43.148215, -89.29933], [43.148339, -89.299336], [43.148458, -89.299333], [43.148575, -89.299324], [43.148753, -89.299289], [43.148931, -89.299254], [43.149109, -89.29922], [43.149287, -89.299185], [43.149465, -89.29915], [43.149643, -89.299115], [43.06073, -89.489563], [43.149821, -89.299081], [43.15, -89.299046], [43.150178, -89.299011], [43.150245, -89.298998], [43.150423, -89.298963], [43.150601, -89.298929], [43.150779, -89.298894], [43.150957, -89.298859], [43.151107, -89.29884], [43.151224, -89.298833], [43.060731, -89.489317], [43.151369, -89.298825], [43.151549, -89.29876], [43.151671, -89.298792], [43.151793, -89.298825], [43.151916, -89.298857], [43.152038, -89.298889], [43.152148, -89.298923], [43.152258, -89.298958], [43.15242, -89.299098], [43.152582, -89.299238], [43.060731, -89.489192], [43.152684, -89.299321], [43.152785, -89.299404], [43.152893, -89.299535], [43.153001, -89.299667], [43.153124, -89.299828], [43.153247, -89.299989], [43.153349, -89.300195], [43.153451, -89.300402], [43.153525, -89.3006], [43.153599, -89.300799], [43.060737, -89.488946], [43.153647, -89.300934], [43.153695, -89.30107], [43.153743, -89.301205], [43.153791, -89.301341], [43.153778, -89.301587], [43.153764, -89.301833], [43.153776, -89.301997], [43.153782, -89.302161], [43.153781, -89.302325], [43.153783, -89.302572], [43.060742, -89.4887], [43.153785, -89.302818], [43.153786, -89.302997], [43.153789, -89.303177], [43.153787, -89.303357], [43.15378, -89.303536], [43.153767, -89.303716], [43.15375, -89.303895], [43.153738, -89.304079], [43.153734, -89.304263], [43.153736, -89.304447], [43.060748, -89.488454], [43.153796, -89.304468], [43.153846, -89.304508], [43.15388, -89.304562], [43.153893, -89.304624], [43.153894, -89.304688], [43.153881, -89.304752], [43.153847, -89.304808], [43.153796, -89.304849], [43.153735, -89.30487], [43.15376, -89.305036], [43.060754, -89.488208], [43.153758, -89.305283], [43.153755, -89.305529], [43.153753, -89.305776], [43.153751, -89.305968], [43.153748, -89.306215], [43.153746, -89.306461], [43.153744, -89.306708], [43.153742, -89.306954], [43.153741, -89.307201], [43.153739, -89.307447], [43.060759, -89.487962], [43.153737, -89.307694], [43.153735, -89.30794], [43.153733, -89.308187], [43.153732, -89.308284], [43.153735, -89.308531], [43.153737, -89.308777], [43.15374, -89.309024], [43.153742, -89.30927], [43.153745, -89.309517], [43.153742, -89.309763], [43.060765, -89.487716], [43.153739, -89.31001], [43.153738, -89.310144], [43.153738, -89.310391], [43.153739, -89.310637], [43.153739, -89.310884], [43.15374, -89.31113], [43.153737, -89.311377], [43.153733, -89.311623], [43.15373, -89.31187], [43.153727, -89.312116], [43.060116, -89.52743], [43.06077, -89.48747], [43.153724, -89.312332], [43.153723, -89.312579], [43.153722, -89.312825], [43.153721, -89.313072], [43.15372, -89.313318], [43.153718, -89.313565], [43.153718, -89.313652], [43.153716, -89.313899], [43.153714, -89.314145], [43.153711, -89.314392], [43.060776, -89.487224], [43.15371, -89.314539], [43.153708, -89.314786], [43.153707, -89.315032], [43.153748, -89.315272], [43.153789, -89.315512], [43.153803, -89.315591], [43.060782, -89.486977], [43.060787, -89.486731], [43.060789, -89.486655], [43.060757, -89.486413], [43.060737, -89.486267], [43.060738, -89.486021], [43.060738, -89.485775], [43.060739, -89.485528], [43.057386, -89.527483], [43.060296, -89.527428], [43.060739, -89.485384], [43.060739, -89.485138], [43.060739, -89.484892], [43.060739, -89.484661], [43.06074, -89.484451], [43.06074, -89.48438], [43.06074, -89.484134], [43.060741, -89.483888], [43.060741, -89.483739], [43.060742, -89.483493], [43.060338, -89.527189], [43.060744, -89.483247], [43.060745, -89.483], [43.060747, -89.482754], [43.060748, -89.482508], [43.06075, -89.482262], [43.060751, -89.482016], [43.060752, -89.481874], [43.060753, -89.481628], [43.060755, -89.481382], [43.060756, -89.481135], [43.060342, -89.526942], [43.060758, -89.480889], [43.060759, -89.480643], [43.06076, -89.480397], [43.060761, -89.480297], [43.060763, -89.480051], [43.060765, -89.479805], [43.060767, -89.479559], [43.060783, -89.479313], [43.060798, -89.479068], [43.060814, -89.478823], [43.060346, -89.526696], [43.060829, -89.478596], [43.060795, -89.478354], [43.060775, -89.478211], [43.060776, -89.477965], [43.060778, -89.477719], [43.06078, -89.477473], [43.060781, -89.477226], [43.060783, -89.47698], [43.060784, -89.47684], [43.060786, -89.476594], [43.060349, -89.52645], [43.060787, -89.476355], [43.060789, -89.476109], [43.060789, -89.476053], [43.060791, -89.475807], [43.060792, -89.475668], [43.060795, -89.475422], [43.060796, -89.475176], [43.060796, -89.475074], [43.060798, -89.474828], [43.060798, -89.474757], [43.060351, -89.526277], [43.0608, -89.474511], [43.060807, -89.474265], [43.060815, -89.474019], [43.060823, -89.473773], [43.060831, -89.473527], [43.060838, -89.473281], [43.060846, -89.473035], [43.060854, -89.472789], [43.060862, -89.472543], [43.060867, -89.472363], [43.060355, -89.526031], [43.061008, -89.47221], [43.06112, -89.472087], [43.061298, -89.472124], [43.061476, -89.472162], [43.061653, -89.4722], [43.061831, -89.472237], [43.061934, -89.472259], [43.062043, -89.472282], [43.062154, -89.472297], [43.062265, -89.472306], [43.060359, -89.525785], [43.062377, -89.472307], [43.062489, -89.472302], [43.0626, -89.472289], [43.06271, -89.472269], [43.062818, -89.472242], [43.062925, -89.472208], [43.063029, -89.472167], [43.06313, -89.47212], [43.063228, -89.472066], [43.063323, -89.472006], [43.060361, -89.525695], [43.063413, -89.47194], [43.063569, -89.471819], [43.063726, -89.471697], [43.063882, -89.471576], [43.064039, -89.471455], [43.064196, -89.471334], [43.064308, -89.471247], [43.064446, -89.471126], [43.06458, -89.471001], [43.064709, -89.47087], [43.060365, -89.525449], [43.064833, -89.470735], [43.064951, -89.470595], [43.065065, -89.47045], [43.06519, -89.470273], [43.065315, -89.470096], [43.065441, -89.46992], [43.065566, -89.469743], [43.065691, -89.469566], [43.065816, -89.469389], [43.065941, -89.469213], [43.057487, -89.527477], [43.060369, -89.525203], [43.066055, -89.469052], [43.066099, -89.468991], [43.066146, -89.468932], [43.066196, -89.468875], [43.066263, -89.468799], [43.066335, -89.468727], [43.066411, -89.46866], [43.066492, -89.468598], [43.066576, -89.468542], [43.066664, -89.468491], [43.060372, -89.524957], [43.066755, -89.468446], [43.066849, -89.468407], [43.066941, -89.468374], [43.067036, -89.468347], [43.067132, -89.468327], [43.067229, -89.468314], [43.067326, -89.468308], [43.067505, -89.468335], [43.067684, -89.468361], [43.067862, -89.468388], [43.060376, -89.524711], [43.067896, -89.468393], [43.068074, -89.46836], [43.068253, -89.468328], [43.068432, -89.468324], [43.068612, -89.468323], [43.068792, -89.468324], [43.068972, -89.468325], [43.069152, -89.468325], [43.069332, -89.468325], [43.069512, -89.468325], [43.06038, -89.524464], [43.069691, -89.468325], [43.069871, -89.468325], [43.070051, -89.468325], [43.070121, -89.468325], [43.070301, -89.468325], [43.070481, -89.468326], [43.070661, -89.468326], [43.07084, -89.468327], [43.07102, -89.468327], [43.0712, -89.468328], [43.060384, -89.524218], [43.071362, -89.468328], [43.071462, -89.468327], [43.071562, -89.46832], [43.071661, -89.468307], [43.071759, -89.468287], [43.071856, -89.468261], [43.07195, -89.468229], [43.072043, -89.46819], [43.072133, -89.468146], [43.072219, -89.468096], [43.060388, -89.523972], [43.072303, -89.46804], [43.072462, -89.467925], [43.072621, -89.467811], [43.072781, -89.467696], [43.07294, -89.467582], [43.073099, -89.467467], [43.073141, -89.467437], [43.073105, -89.467313], [43.073042, -89.46709], [43.072974, -89.466862], [43.060392, -89.523726], [43.072948, -89.466776], [43.072916, -89.466668], [43.07289, -89.46658], [43.072838, -89.466409], [43.07278, -89.466198], [43.072747, -89.466048], [43.072725, -89.465864], [43.072725, -89.465743], [43.072727, -89.465662], [43.072758, -89.465419], [43.060395, -89.52348], [43.072766, -89.465357], [43.072796, -89.465114], [43.072827, -89.464872], [43.072858, -89.464629], [43.072889, -89.464387], [43.072897, -89.464327], [43.072912, -89.464228], [43.072922, -89.464157], [43.072933, -89.464073], [43.072961, -89.46383], [43.060399, -89.523234], [43.072983, -89.463644], [43.072999, -89.463399], [43.073008, -89.463253], [43.073012, -89.463179], [43.073018, -89.46298], [43.073017, -89.462734], [43.073012, -89.462514], [43.073009, -89.462458], [43.072997, -89.462212], [43.072979, -89.461967], [43.060402, -89.523058], [43.072964, -89.461757], [43.072945, -89.461512], [43.072927, -89.461267], [43.072909, -89.461022], [43.072892, -89.460777], [43.072886, -89.46071], [43.072868, -89.460465], [43.072851, -89.46022], [43.072837, -89.459974], [43.072823, -89.459729], [43.057588, -89.527472], [43.060402, -89.522812], [43.072818, -89.45965], [43.072808, -89.459404], [43.072812, -89.459204], [43.072834, -89.45896], [43.072854, -89.458715], [43.072865, -89.458584], [43.07289, -89.45834], [43.072898, -89.458267], [43.072904, -89.458183], [43.072911, -89.4581], [43.060402, -89.522566], [43.072929, -89.457899], [43.072934, -89.457839], [43.072945, -89.457739], [43.072953, -89.457655], [43.072974, -89.457419], [43.072994, -89.457174], [43.073041, -89.45692], [43.073088, -89.456666], [43.073189, -89.456692], [43.073289, -89.456719], [43.060407, -89.52232], [43.073414, -89.456728], [43.073538, -89.456737], [43.073663, -89.456747], [43.073787, -89.456756], [43.073959, -89.456769], [43.074108, -89.456771], [43.07421, -89.456768], [43.07439, -89.456776], [43.07457, -89.456784], [43.074749, -89.456791], [43.060412, -89.522073], [43.074929, -89.456799], [43.075109, -89.456807], [43.075253, -89.456813], [43.075254, -89.456567], [43.075255, -89.456457], [43.07526, -89.456211], [43.075265, -89.455979], [43.075265, -89.455733], [43.075265, -89.455487], [43.075265, -89.455402], [43.060418, -89.521827], [43.075263, -89.455156], [43.075262, -89.455049], [43.075259, -89.454803], [43.075256, -89.454557], [43.075256, -89.45431], [43.075257, -89.454064], [43.075257, -89.453928], [43.075256, -89.453682], [43.075254, -89.453436], [43.075253, -89.453218], [43.060422, -89.521581], [43.075248, -89.452972], [43.075244, -89.452734], [43.075249, -89.452488], [43.075253, -89.452242], [43.075258, -89.451996], [43.075263, -89.451749], [43.075267, -89.451503], [43.075269, -89.451411], [43.075246, -89.451167], [43.075223, -89.450923], [43.060425, -89.521335], [43.075213, -89.450821], [43.075212, -89.450575], [43.075211, -89.450329], [43.07521, -89.450082], [43.07521, -89.449991], [43.075212, -89.449745], [43.075215, -89.449499], [43.075217, -89.449252], [43.075219, -89.449006], [43.075221, -89.448797], [43.060429, -89.521089], [43.07522, -89.448551], [43.075219, -89.448305], [43.075218, -89.448058], [43.075217, -89.44789], [43.075211, -89.447644], [43.07521, -89.447588], [43.075206, -89.447342], [43.075202, -89.447096], [43.075198, -89.44686], [43.075197, -89.446673], [43.060433, -89.520843], [43.075195, -89.446427], [43.075193, -89.446279], [43.075191, -89.446033], [43.07519, -89.445888], [43.075188, -89.445642], [43.075188, -89.445572], [43.075187, -89.445326], [43.075187, -89.445106], [43.075181, -89.44486], [43.075176, -89.444655], [43.060437, -89.520597], [43.075175, -89.444409], [43.075174, -89.444163], [43.075172, -89.443916], [43.075171, -89.44367], [43.075209, -89.443429], [43.075235, -89.443263], [43.075228, -89.443017], [43.075221, -89.442771], [43.075214, -89.442525], [43.075207, -89.442279], [43.057689, -89.527466], [43.06044, -89.520351], [43.0752, -89.442033], [43.075193, -89.441787], [43.075186, -89.441541], [43.07518, -89.441349], [43.075166, -89.441104], [43.075146, -89.440859], [43.07512, -89.440615], [43.075087, -89.440373], [43.075048, -89.440133], [43.075001, -89.439895], [43.060444, -89.520105], [43.074949, -89.439659], [43.074897, -89.439424], [43.074845, -89.439188], [43.074793, -89.438952], [43.074759, -89.4388], [43.074702, -89.438566], [43.074645, -89.438333], [43.074588, -89.438099], [43.074535, -89.437864], [43.074522, -89.437805], [43.060448, -89.519858], [43.074465, -89.437571], [43.074451, -89.437513], [43.07439, -89.437281], [43.074375, -89.437222], [43.074311, -89.436992], [43.074294, -89.436932], [43.07423, -89.436702], [43.074165, -89.436472], [43.074101, -89.436242], [43.074038, -89.436012], [43.060449, -89.519774], [43.073975, -89.435781], [43.073912, -89.43555], [43.073849, -89.43532], [43.073786, -89.435089], [43.073723, -89.434858], [43.07366, -89.434628], [43.073597, -89.434397], [43.073534, -89.434167], [43.073471, -89.433936], [43.073416, -89.433735], [43.060451, -89.519528], [43.073384, -89.433493], [43.073365, -89.43335], [43.073288, -89.433128], [43.073211, -89.432905], [43.073185, -89.432831], [43.073138, -89.432616], [43.073097, -89.432399], [43.073062, -89.432182], [43.073025, -89.431941], [43.072993, -89.431699], [43.060454, -89.519282], [43.072966, -89.431455], [43.072946, -89.431211], [43.072933, -89.430965], [43.072927, -89.430853], [43.072918, -89.430607], [43.072914, -89.430495], [43.072909, -89.430249], [43.072906, -89.430137], [43.072905, -89.429891], [43.072904, -89.429779], [43.060456, -89.519036], [43.072906, -89.429533], [43.072907, -89.429421], [43.072907, -89.429175], [43.072908, -89.428929], [43.072908, -89.428759], [43.072916, -89.428513], [43.07292, -89.428394], [43.072932, -89.428148], [43.072938, -89.428029], [43.072954, -89.427784], [43.060459, -89.518789], [43.072962, -89.427665], [43.072983, -89.42742], [43.072993, -89.427301], [43.073014, -89.427056], [43.073034, -89.426812], [43.073055, -89.426567], [43.073076, -89.426323], [43.073091, -89.426142], [43.073115, -89.425898], [43.073139, -89.425654], [43.060461, -89.518543], [43.073163, -89.42541], [43.073187, -89.425166], [43.073222, -89.424924], [43.073256, -89.424683], [43.073291, -89.424441], [43.073326, -89.4242], [43.07336, -89.423958], [43.073395, -89.423716], [43.07343, -89.423475], [43.073464, -89.423233], [43.060463, -89.518297], [43.073499, -89.422991], [43.073534, -89.42275], [43.073568, -89.422508], [43.07359, -89.422357], [43.073627, -89.422116], [43.073664, -89.421875], [43.073701, -89.421634], [43.073733, -89.421392], [43.073764, -89.421149], [43.073786, -89.420983], [43.05779, -89.527461], [43.060466, -89.518051], [43.073815, -89.42074], [43.073843, -89.420497], [43.073851, -89.420431], [43.073874, -89.420187], [43.073896, -89.419942], [43.073906, -89.419837], [43.073928, -89.419593], [43.073951, -89.419348], [43.07397, -89.419137], [43.073985, -89.418892], [43.060468, -89.517805], [43.073997, -89.418695], [43.074014, -89.41845], [43.07403, -89.418205], [43.074041, -89.417959], [43.074051, -89.417713], [43.074061, -89.417467], [43.074066, -89.417354], [43.074074, -89.417108], [43.074081, -89.416862], [43.074089, -89.416616], [43.06047, -89.517559], [43.074096, -89.41637], [43.074104, -89.416124], [43.074111, -89.415878], [43.074119, -89.415632], [43.074126, -89.415386], [43.074131, -89.415235], [43.074132, -89.415055], [43.074128, -89.414875], [43.074117, -89.414695], [43.074101, -89.414516], [43.060471, -89.517496], [43.074079, -89.414337], [43.074058, -89.414181], [43.074032, -89.414025], [43.074, -89.413871], [43.073963, -89.413717], [43.073921, -89.413565], [43.073891, -89.413472], [43.073855, -89.413382], [43.073812, -89.413294], [43.073763, -89.413209], [43.060512, -89.517256], [43.073648, -89.413055], [43.073602, -89.412991], [43.073558, -89.412925], [43.073515, -89.41285], [43.073478, -89.412773], [43.073445, -89.412693], [43.073418, -89.412612], [43.073395, -89.412529], [43.073378, -89.412445], [43.073359, -89.41231], [43.060538, -89.517104], [43.073348, -89.412064], [43.073337, -89.411818], [43.073325, -89.411573], [43.073314, -89.411327], [43.073303, -89.411081], [43.073292, -89.410835], [43.073286, -89.410707], [43.07328, -89.410608], [43.073269, -89.410509], [43.073253, -89.410412], [43.060531, -89.516858], [43.073232, -89.410315], [43.073206, -89.410219], [43.073175, -89.410125], [43.073099, -89.409902], [43.073024, -89.409678], [43.073004, -89.409619], [43.072928, -89.409396], [43.072853, -89.409172], [43.072801, -89.409019], [43.072727, -89.408795], [43.060523, -89.516612], [43.072653, -89.40857], [43.072579, -89.408346], [43.072554, -89.408271], [43.072477, -89.408048], [43.0724, -89.407826], [43.072361, -89.407712], [43.072316, -89.407543], [43.072278, -89.407373], [43.072179, -89.407167], [43.07212, -89.407043], [43.060516, -89.516366], [43.072165, -89.406805], [43.072189, -89.406675], [43.072179, -89.4065], [43.072174, -89.406324], [43.072171, -89.40609], [43.072168, -89.405844], [43.072166, -89.40573], [43.072163, -89.405484], [43.07216, -89.405305], [43.072157, -89.405132], [43.060508, -89.51612], [43.072155, -89.404886], [43.072155, -89.404828], [43.072152, -89.404725], [43.072148, -89.404479], [43.072144, -89.404233], [43.072143, -89.404165], [43.072141, -89.404089], [43.072137, -89.403962], [43.072138, -89.40384], [43.072134, -89.403594], [43.057964, -89.527461], [43.060501, -89.515874], [43.07213, -89.403348], [43.072125, -89.403102], [43.072121, -89.402855], [43.072117, -89.402609], [43.072114, -89.402446], [43.07211, -89.4022], [43.072106, -89.401954], [43.072102, -89.401708], [43.072098, -89.401461], [43.072094, -89.401215], [43.060495, -89.515678], [43.07209, -89.400969], [43.072088, -89.400831], [43.072088, -89.400734], [43.072087, -89.400668], [43.072083, -89.400422], [43.072079, -89.400176], [43.072075, -89.39993], [43.072072, -89.399683], [43.072068, -89.399437], [43.072064, -89.399191], [43.060495, -89.515432], [43.072062, -89.399068], [43.071994, -89.39884], [43.071949, -89.398686], [43.071967, -89.398441], [43.071984, -89.398196], [43.072002, -89.397951], [43.07202, -89.397706], [43.072037, -89.397461], [43.072033, -89.397215], [43.072029, -89.396968], [43.060495, -89.515186], [43.072026, -89.396722], [43.072022, -89.396476], [43.072018, -89.39623], [43.072014, -89.395984], [43.072012, -89.39587], [43.072008, -89.395624], [43.072004, -89.395378], [43.072, -89.395132], [43.071995, -89.394885], [43.071992, -89.394683], [43.060495, -89.514939], [43.07199, -89.394437], [43.071989, -89.394284], [43.071994, -89.394204], [43.072004, -89.394124], [43.072021, -89.394045], [43.072043, -89.393967], [43.07207, -89.393891], [43.072103, -89.393818], [43.072141, -89.393746], [43.072256, -89.393557], [43.060495, -89.514693], [43.072379, -89.393377], [43.072502, -89.393198], [43.072625, -89.393018], [43.072749, -89.392839], [43.072872, -89.392659], [43.072995, -89.39248], [43.073118, -89.3923], [43.073241, -89.392121], [43.073364, -89.391942], [43.073488, -89.391762], [43.060495, -89.514447], [43.073613, -89.391586], [43.073739, -89.39141], [43.073865, -89.391234], [43.073991, -89.391058], [43.074116, -89.390882], [43.074242, -89.390706], [43.074368, -89.39053], [43.074494, -89.390354], [43.074581, -89.39025], [43.074667, -89.390146], [43.060495, -89.514201], [43.074754, -89.390042], [43.07484, -89.389938], [43.074754, -89.389757], [43.074668, -89.389575], [43.074723, -89.38944], [43.074777, -89.389305], [43.074774, -89.389112], [43.074772, -89.388919], [43.074769, -89.388727], [43.074766, -89.388534], [43.060495, -89.514137], [43.074763, -89.388341], [43.07476, -89.388148], [43.074757, -89.387955], [43.074754, -89.387762], [43.074751, -89.38757], [43.074748, -89.387377], [43.074745, -89.387184], [43.074742, -89.386991], [43.074739, -89.386798], [43.074736, -89.386606], [43.0605, -89.513891], [43.074733, -89.386413], [43.07473, -89.38622], [43.07464, -89.386188], [43.074555, -89.386075], [43.07447, -89.385962], [43.074385, -89.38585], [43.074299, -89.385737], [43.074208, -89.38562], [43.074117, -89.385502], [43.074026, -89.385385], [43.058138, -89.527461], [43.060505, -89.513645], [43.073935, -89.385268], [43.073844, -89.38515], [43.073753, -89.385033], [43.073662, -89.384916], [43.07357, -89.384798], [43.073435, -89.384629], [43.0733, -89.38446], [43.073198, -89.384299], [43.073179, -89.384187], [43.073237, -89.384047], [43.06051, -89.513399], [43.073306, -89.38395], [43.073374, -89.383854], [43.073442, -89.383757], [43.07351, -89.38366], [43.07362, -89.38351], [43.073547, -89.383415], [43.07362, -89.38351], [43.073688, -89.383413], [43.073755, -89.383315], [43.073823, -89.383218], [43.060512, -89.513322], [43.07389, -89.38312], [43.07401, -89.382955], [43.07413, -89.38279], [43.07425, -89.382625], [43.07437, -89.38246], [43.07441, -89.3824], [43.07448, -89.3823], [43.07457, -89.38217], [43.07459, -89.38215], [43.0746, -89.38215], [43.060512, -89.513076], [43.07462, -89.38214], [43.07463, -89.38213], [43.07467, -89.38213], [43.0747, -89.38213], [43.07474, -89.38215], [43.07478, -89.38218], [43.074865, -89.382291], [43.07495, -89.382402], [43.075035, -89.382514], [43.07512, -89.382625], [43.060513, -89.51283], [43.075205, -89.382736], [43.07529, -89.382847], [43.075375, -89.382959], [43.07546, -89.38307], [43.07551, -89.38301], [43.07553, -89.38297], [43.075628, -89.382838], [43.075725, -89.382705], [43.075823, -89.382573], [43.07592, -89.38244], [43.060513, -89.512658], [43.07598, -89.38233], [43.07597, -89.38216], [43.07608, -89.382], [43.07621, -89.38183], [43.07623, -89.38181], [43.076355, -89.38166], [43.07648, -89.38151], [43.07651, -89.38145], [43.076615, -89.3813], [43.07672, -89.38115], [43.060516, -89.512412], [43.07685, -89.38097], [43.07695, -89.38082], [43.07698, -89.38077], [43.0771, -89.380605], [43.07722, -89.38044], [43.07728, -89.38036], [43.07734, -89.38026], [43.07741, -89.38016], [43.077505, -89.38003], [43.0776, -89.3799], [43.06052, -89.512166], [43.07766, -89.37981], [43.0777, -89.37977], [43.077775, -89.37966], [43.07785, -89.37955], [43.07797, -89.37937], [43.078073, -89.379218], [43.078175, -89.379065], [43.078278, -89.378913], [43.078407, -89.378795], [43.07851, -89.378593], [43.060523, -89.51192], [43.078584, -89.378449], [43.07871, -89.378274], [43.078837, -89.378099], [43.078963, -89.377924], [43.07909, -89.377749], [43.079217, -89.377574], [43.079343, -89.377399], [43.07947, -89.377225], [43.079597, -89.377049], [43.079723, -89.376875], [43.060526, -89.511673], [43.079847, -89.376696], [43.079972, -89.376518], [43.080096, -89.376341], [43.08022, -89.376162], [43.080345, -89.375984], [43.080469, -89.375807], [43.080593, -89.375629], [43.080717, -89.37545], [43.080842, -89.375272], [43.080966, -89.375095], [43.058318, -89.527458], [43.060529, -89.511427], [43.081094, -89.374922], [43.081223, -89.37475], [43.081351, -89.374577], [43.081479, -89.374404], [43.081608, -89.374232], [43.081736, -89.37406], [43.081864, -89.373887], [43.081993, -89.373715], [43.082121, -89.373542], [43.082192, -89.373447], [43.060533, -89.511181], [43.082295, -89.373245], [43.082366, -89.373107], [43.08249, -89.372929], [43.082615, -89.372751], [43.082739, -89.372573], [43.082863, -89.372395], [43.082987, -89.372217], [43.083112, -89.372039], [43.083236, -89.37186], [43.08336, -89.371682], [43.060536, -89.510935], [43.083484, -89.371504], [43.08361, -89.371328], [43.083735, -89.371151], [43.08386, -89.370974], [43.083986, -89.370798], [43.084111, -89.370621], [43.084236, -89.370444], [43.084362, -89.370268], [43.084487, -89.370091], [43.084612, -89.369914], [43.060539, -89.510689], [43.084738, -89.369738], [43.084863, -89.369561], [43.084988, -89.369384], [43.085114, -89.369208], [43.085239, -89.369031], [43.085364, -89.368854], [43.085489, -89.368678], [43.085615, -89.368501], [43.08574, -89.368324], [43.085865, -89.368148], [43.060543, -89.510443], [43.085991, -89.367971], [43.086078, -89.367848], [43.086207, -89.367676], [43.086335, -89.367504], [43.086464, -89.367332], [43.086593, -89.36716], [43.086721, -89.366987], [43.08685, -89.366815], [43.086979, -89.366643], [43.087107, -89.366471], [43.060546, -89.510197], [43.087221, -89.366319], [43.087325, -89.366118], [43.087397, -89.36598], [43.087522, -89.365803], [43.087647, -89.365625], [43.087772, -89.365448], [43.087896, -89.365271], [43.088021, -89.365094], [43.088146, -89.364916], [43.088271, -89.364739], [43.060549, -89.509951], [43.088396, -89.364562], [43.088521, -89.364385], [43.088647, -89.364209], [43.088773, -89.364034], [43.0889, -89.363858], [43.089026, -89.363683], [43.089152, -89.363507], [43.089278, -89.363332], [43.089404, -89.363156], [43.089531, -89.362981], [43.060551, -89.509704], [43.089657, -89.362805], [43.089783, -89.36263], [43.089909, -89.362454], [43.090036, -89.362279], [43.090162, -89.362104], [43.090288, -89.361928], [43.090414, -89.361753], [43.09054, -89.361577], [43.090667, -89.361402], [43.090793, -89.361226], [43.060554, -89.509458], [43.090919, -89.361051], [43.091045, -89.360875], [43.091171, -89.3607], [43.091298, -89.360524], [43.091424, -89.360349], [43.09155, -89.360173], [43.091676, -89.359998], [43.091803, -89.359823], [43.091929, -89.359647], [43.092055, -89.359472], [43.060557, -89.509212], [43.092133, -89.359363], [43.09224, -89.359165], [43.092314, -89.359028], [43.092442, -89.358855], [43.092571, -89.358683], [43.092699, -89.358511], [43.092828, -89.358339], [43.092957, -89.358167], [43.093085, -89.357994], [43.093214, -89.357822]
]

function distance(latLon1, latLon2) {
    if (!latLon1 || !latLon2) return 1;
    const [lat1, lon1] = latLon1;
    const [lat2, lon2] = latLon2;
    const R = 6371;

    const toRadians = (angle) => angle * (Math.PI / 180);
    const dLat = toRadians(lat2 - lat1);
    const dLon = toRadians(lon2 - lon1);

    const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(toRadians(lat1)) *
        Math.cos(toRadians(lat2)) *
        Math.sin(dLon / 2) *
        Math.sin(dLon / 2);

    const c = 2 * Math.asin(Math.sqrt(a));

    return R * c;
}

function getBounds(route) {
    let minLat = Math.min(...route.map(r => r[1]));
    let minLon = Math.min(...route.map(r => r[0]));
    let maxLat = Math.max(...route.map(r => r[1]));
    let maxLon = Math.max(...route.map(r => r[0]));
    let bounds = [[minLon, minLat], [maxLon, maxLat]];
    console.log("bounds", bounds);
    return bounds;
}

function TrainMover({route}) {
    // Reducer to update progress and the current segment
    function reducer(state, action) {
        switch (action.type) {
            case 'TICK': {
                let newProgress = state.progress + (action.payload / distance(route[state.currIndex], route[state.currIndex + state.direction]));
                let newIndex = state.currIndex;
                let newDirection = state.direction;
                if (newProgress >= 1) {
                    newProgress = 0;
                    const nextIndex = state.currIndex + state.direction;
                    // If the next index is out of bounds, flip the direction (bounce)
                    if (nextIndex < 0 || nextIndex >= route.length) {
                        newDirection = -state.direction;
                    } else {
                        newIndex = nextIndex;
                    }
                }
                if ((newIndex >= route.length - 1 && newDirection > 0) ||
                    (newIndex <= 0 && newDirection < 0)) {
                    newDirection = -newDirection
                }
                let newState = {
                    progress: newProgress,
                    currIndex: newIndex,
                    direction: newDirection,
                };
                return newState;
            }
            default:
                return state;
        }
    }

    const markerRef = useRef(null);
    const [state, dispatch] = useReducer(reducer, initialState);

    // Drive the animation with a setInterval (or requestAnimationFrame if desired)
    useEffect(() => {
        const interval = setInterval(() => {
            dispatch({type: 'TICK', payload: 1});
        }, 30);
        return () => clearInterval(interval);
    }, []);

    // Update the marker position whenever state changes
    useEffect(() => {
        if (!markerRef.current) return;
        const start = route[state.currIndex];
        // Compute the next index based on the direction
        let nextIndex = state.currIndex + state.direction;
        // If out-of-bound, just keep the boundary (the reducer should have flipped direction already)
        if (nextIndex < 0 || nextIndex >= route.length) {
            nextIndex = state.currIndex;
        }
        const end = route[nextIndex];
        const lat = start[0] + (end[0] - start[0]) * state.progress;
        const lng = start[1] + (end[1] - start[1]) * state.progress;
        markerRef.current.setLatLng([lat, lng]);
    }, [state]);

    return <Marker ref={markerRef} position={route[0]} icon={trainIcon}/>;
}

export default function MapBackground() {
    const [route, setRoute] = useState(undefined);
    const mapRef = useRef();

    function setRandomShape() {
        (async () => {
            let route = (await getRandomShape())?.shape;
            route = route ? route : defaultRoute;
            setRoute(route);
        })()
    }

    useEffect(() => {
        setRandomShape();
        const interval = setInterval(() => {
            setRandomShape();
        }, 60000);
        return () => clearInterval(interval);
    }, [])

    useEffect(() => {
        mapRef?.current?.fitBounds(getBounds(route));
    }, [route]);
    return route && (
        <MapContainer
            ref={mapRef}
            bounds={getBounds(route)}
            className="absolute inset-0 h-screen w-screen"
            zoomControl={false}
            attributionControl={false}
            dragging={false}
            scrollWheelZoom={false}
            doubleClickZoom={false}
            boxZoom={false}
            keyboard={false}
            touchZoom={false}
            style={{width: "100%", position: "fixed", zIndex: -1}}
        >
            <TileLayer
                url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
                attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            />
            <Polyline positions={route} color="red" weight={4}/>
            <TrainMover route={route}/>
        </MapContainer>
    );
}
